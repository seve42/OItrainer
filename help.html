<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>帮助 — OI 教练模拟器</title>
<link rel="stylesheet" href="styles.css">
<style>
  .doc{max-width:900px;margin:24px auto;padding:18px;background:#fff;border-radius:8px}
  .doc h2{margin-top:14px}
  .muted{color:#666}
  .example{background:#f7f9fc;padding:10px;border-radius:6px;border:1px solid #eef4fb}
  ul.guide{padding-left:18px}
  .pill{display:inline-block;padding:4px 8px;margin:6px 6px 6px 0;border-radius:999px;background:#eef6ff;color:#1b4f8a}
</style>
<!-- Clarity tracking removed -->
  <!-- Cloudflare Web Analytics loader (conditional: only load if page load time <= 2s) -->
  <script>
    (function(){
      function injectCF(){
        var s = document.createElement('script');
        s.defer = true;
        s.src = 'https://static.cloudflareinsights.com/beacon.min.js';
        s.setAttribute('data-cf-beacon', '{"token": "cd3db41765ea4c17be0930b3f94e3c3a"}');
        document.head.appendChild(s);
      }
      function shouldLoad(){
        try{
          var start = (performance.timing && performance.timing.navigationStart) || 0;
          var elapsed = performance.now ? performance.now() : (Date.now() - start);
          return elapsed <= 2000;
        }catch(e){ return false; }
      }
      document.addEventListener('DOMContentLoaded', function(){ if(shouldLoad()) injectCF(); });
    })();
  </script>
</head>
<body>
<div class="container">
  <div class="doc">
    <h1>玩法说明（完整机制版）</h1>

    <p class="muted">本说明基于当前代码实现撰写，覆盖赛季推进、比赛模拟、训练与题库、天赋、事件、设施与预算、天气与舒适度等系统的详细机制与玩法建议。</p>

    <h2>一、赛季与周目</h2>
    <ul class="guide">
      <li>游戏按“周”为时间单位推进，完整赛季为约 28 周，分上下两轮；系统会将原始年度赛程按比例映射到两轮赛季中。</li>
      <li>核心赛事顺序固定：CSP-S1 → CSP-S2 → NOIP → 省选 → NOI；每场比赛在预定周数触发。</li>
      <li>每周结束时结算维护费用、天气变化与随机事件，保存关键状态到本地存档。</li>
    </ul>

    <h2>二、开局与省份</h2>
    <ul class="guide">
      <li>省份决定初始经费、训练质量与南北方属性：强省经费与训练质量更高，弱省更低；南北方影响气温分布与极端天气概率。</li>
      <li>训练质量会作为隐式系数影响训练与成长效率，强省更易出成绩。</li>
    </ul>

    <h2>三、学生模型</h2>
    <ul class="guide">
      <li><strong>基础能力</strong>：思维(Thinking)、编程(Coding)、心理(Mental)。综合能力以思维约55%、编程约35%、心理约10%加权。</li>
      <li><strong>知识结构</strong>：数据结构、图论、字符串、数学、DP 五大类，各自有独立数值，并在比赛中参与“知识门槛”判定。</li>
      <li><strong>压力与舒适</strong>：高压力会降低学习效率、增加退队/生病概率；舒适度受设施与天气影响，进而影响压力与恢复。</li>
      <li><strong>状态</strong>：生病(sick_weeks)、燃尽(burnout)与退队(active=false)等。合理安排休息、娱乐与设施升级可降低风险。</li>
      <li><strong>综合得分</strong>：比赛中以“综合能力+知识加成”与题目难度对比，经稳定性与噪声处理后转化为得分。</li>
    </ul>

    <h2>四、训练与成长</h2>
    <ul class="guide">
      <li>训练按周执行，可选不同强度；强度越高增长越多，但压力也涨得更快，长期高压会带来退队风险。</li>
      <li>能力增益受学生自身（思维、压力）、设施（机房/资料库）、省份训练质量与是否生病等因素影响。</li>
      <li>知识会按极小幅度“遗忘”衰减（长期不练会缓慢回落），保持持续训练可抵消遗忘。</li>
    </ul>

    <h2>五、题库系统</h2>
    <ul class="guide">
      <li>内置大量题目，每题有难度与 boosts（命中后提升的知识点类别与幅度）。</li>
      <li>系统在训练/模拟赛中会按学生当前能力匹配题目，并将子任务完成情况转化为知识提升。</li>
      <li>设施与舒适度会间接影响做题效率（例如机房与资料库加成）。</li>
    </ul>

    <h2>六、模拟赛与付费模拟</h2>
    <ul class="guide">
      <li>你可以在非比赛周发起模拟赛（练习），可选择普通或付费题库；付费题库有更高质量、成长更稳定的回报。</li>
      <li>模拟赛结束后，系统按子任务得分将知识与状态变化写回学生，帮助在正式赛前快速补短板。</li>
    </ul>

    <h2>七、外出集训</h2>
    <ul class="guide">
      <li>提供基础/进阶/高级三档，分别带来知识与能力的大幅提升，同时显著提高压力并消耗大量经费。</li>
      <li>费用会受省份强弱与声誉影响（高声誉可享折扣），合理安排可在大赛前形成能力跃迁。</li>
    </ul>

    <h2>八、比赛模拟（核心玩法）</h2>
    <ul class="guide">
      <li><strong>时长与节拍</strong>：按比赛类型设置总时长，统一以 10 分钟为一个 tick 进行推进与可视化。</li>
      <li><strong>题目结构</strong>：每题由 3-5 个子任务构成，分数逐段提高，最后一段是满分段。</li>
      <li><strong>选题策略</strong>：默认“靠前题权重更高”的加权随机；拥有“稳扎稳打”天赋则严格按序做题。</li>
      <li><strong>思维/代码双检</strong>：尝试通过某段时，分别与该段的思维难度与代码难度比对；两者均达标才算通过。</li>
      <li><strong>知识门槛</strong>：若相关知识低于门槛，会对通过概率施加显著惩罚；补齐知识是稳定提分的关键。</li>
      <li><strong>稳定性</strong>：比赛期间复制心理值为“赛中稳定性”，多项天赋会在不同阶段临时修改它以影响波动。</li>
      <li><strong>跳题与日志</strong>：未通过时可能跳题；所有关键动作（选题/过段/天赋触发）都会记录到右侧比赛日志。</li>
    </ul>

    <h3>晋级链与通过线</h3>
    <ul class="guide">
      <li>每名学生需按顺序“通过当前比赛”才能获得下一场的参赛资格；晋级状态按“上/下半赛季”分别记录。</li>
      <li>通过线由省份基准通过率+赛事修正确定，再结合当场总分设下限/上限，确保难度合理。</li>
      <li>在下半赛季若某场比赛无人通过，视为“晋级链断裂”，直接触发结局。</li>
    </ul>

    <h2>九、天赋系统</h2>
    <ul class="guide">
      <li>由 TalentManager 统一管理：天赋带有描述、颜色、触发概率与处理逻辑，可在一系列比赛事件中触发。</li>
      <li>示例：
        <ul>
          <li>冷静：比赛开始临时提升思维/代码/赛中稳定性。</li>
          <li>爆发型：连续换题后在下一题爆发，思维与各知识临时翻倍。</li>
          <li>心态稳定：解到一定数量的题后，赛中稳定性显著提升。</li>
          <li>Ad-hoc 大师：极小概率“卡卡就过”直接通过最后一档。</li>
          <li>激进：思维提升但稳定性下降，只尝试每题的最后一档。</li>
        </ul>
      </li>
      <li>训练期有概率习得新天赋；高压力下可能丢失天赋。系统会在事件区/日志中展示这些变化。</li>
    </ul>

    <h2>十、事件系统</h2>
    <ul class="guide">
      <li>每周可能触发随机/选择事件：
        <ul>
          <li>环境类：台风（沿海概率更高，降舒适、涨压力并造成经费损失）、极端天气致病。</li>
          <li>运营类：企业赞助、上级拨款、经费审计、设备故障、食堂卫生问题等。</li>
          <li>团队类：金牌教练来访、队内矛盾、交流访问邀请、媒体采访、商业活动。</li>
          <li>个体类：感冒、生病、燃尽退队、天赋习得/丢失、天才学生自荐加入等。</li>
        </ul>
      </li>
      <li>选择事件会在事件卡片区展示选项，点击后即时结算并记录日志。</li>
    </ul>

    <h2>十一、设施与预算</h2>
    <ul class="guide">
      <li><strong>设施</strong>：机房（代码效率）、资料库（知识效率）、空调/宿舍/食堂（舒适与压力）。可升级，越高等级越有效。</li>
      <li><strong>维护与周费</strong>：每周有固定维护开销，学生越多、设施越高花费越大；预算不足将限制高成本行动。</li>
      <li><strong>奖励与收入</strong>：正式赛根据成绩发放奖金；高声誉可提高媒体/商业活动收入。</li>
    </ul>

    <h2>十二、天气与舒适度</h2>
    <ul class="guide">
      <li>系统按季节与南北方生成气温与天气，并给出直观描述（晴/阴/雨/雪与冷热程度）。</li>
      <li>空调与宿舍对舒适度提升显著；极端天气下若空调等级低，会额外施加舒适度惩罚，间接提高生病概率。</li>
    </ul>

    <h2>十三、结局与存档</h2>
    <ul class="guide">
      <li>下半赛季某场比赛无人通过将触发“晋级链断裂”结局，并进入结算页面；全员退队等极端情况也会触发坏结局。</li>
      <li>系统会在关键节点将游戏状态保存到浏览器本地存储，支持跨页恢复。</li>
    </ul>

    <h2>十四、上手建议（玩法要点）</h2>
    <ul class="guide">
      <li>以赛代练：在 CSP-S2/NOIP 前安排 1-2 次付费模拟或外出集训，优先补齐薄弱知识门槛。</li>
      <li>控压与舒适：连续高强度训练要穿插娱乐/休息；尽早升级空调、宿舍与食堂，降低生病与退队风险。</li>
      <li>设施与预算：赛季初期先升资料库与机房，赛前按需补强；注意维护费增长与预算安全边际。</li>
      <li>天赋与组队：关注“稳扎稳打/激进”等风格类天赋，合理搭配以分摊风险与拉高上限。</li>
      <li>省份差异：强省更能承受高频模拟/集训，弱省需更谨慎地滚动发展与控压。</li>
    </ul>

    <h2>界面与操作提示</h2>
    <ul class="guide">
      <li><strong>顶部信息栏</strong>：显示当前周数、省份、经费、声誉与天气；可快速判断赛季节奏与资源状况。</li>
      <li><strong>学生卡</strong>：查看知识分布、压力、天赋与状态；支持单人操作（训练、移除等）。</li>
      <li><strong>行动面板</strong>：每周选择训练/模拟赛/外出集训/娱乐等；在周末统一结算。</li>
      <li><strong>事件卡片</strong>：展示最新动态与选择事件；描述超过一行可展开查看。</li>
      <li><strong>比赛面板</strong>：比赛周进入实时模拟；可暂停/快进 10 回合，右侧日志追踪每个关键动作。</li>
    </ul>
      <li><strong>学生卡</strong>：展示每位学生的基础属性、知识点、压力与状态（生病/退队），并支持对单人安排训练或移除。</li>
      <li><strong>本周行动面板</strong>：用于选择本周的训练/模拟赛/外出集训/娱乐等操作，操作在周结算时生效。</li>
      <li><strong>事件卡片区</strong>：显示近期发生的事件（pushEvent），选择型事件会在卡片上显示选项按钮。</li>
      <li><strong>比赛面板</strong>：在比赛周点击比赛将进入 ContestSimulator 的实时模拟视图，你可以查看每个 tick 的日志和选手得分。</li>
    </ul>

    <div class="modal-actions" style="margin-top:18px">
      <a class="btn" href="#" id="back-to-game-btn">回到游戏</a>
    </div>

  </div>
</div>
<script>
  // 回到游戏时设置会话标记
  document.getElementById('back-to-game-btn').addEventListener('click', function(e) {
    e.preventDefault();
    try {
      sessionStorage.setItem('oi_game_active_session', 'true');
    } catch(err) {
      console.error('无法设置 sessionStorage:', err);
    }
    window.location.href = 'game.html';
  });
</script>
  <footer style="text-align:center;padding:12px 8px;color:#666;font-size:13px;border-top:1px solid #eee;margin-top:18px">
    作者 @Dreamers-seve · 洛谷: <a href="https://www.luogu.com.cn/user/668972" target="_blank" rel="noopener">https://www.luogu.com.cn/user/668972</a> · GitHub: <a href="https://github.com/seve42/OItrainer" target="_blank" rel="noopener">https://github.com/seve42/OItrainer</a>
  </footer>
  <!-- winter plan injection: center link inside footer (or fixed bottom if no footer) -->
  <script>
    (function(){
      try{
        var cutoff = new Date('2026-03-01T00:00:00Z');
        var now = new Date();
        if(now >= cutoff) return;
        var footer = document.querySelector('footer');
        var linkHtml = '<a href="https://www.luogu.me/article/n4gmkam0" target="_blank" rel="noopener" style="color:#1976d2;text-decoration:none;font-weight:600;padding:6px 10px;border-radius:6px">冬日绘板计划</a>';
        var container;
        if(footer){
          container = footer.querySelector('#winter-plan');
          if(!container){
            container = document.createElement('div');
            container.id = 'winter-plan';
            container.style.marginTop = '8px';
            container.style.fontSize = '13px';
            container.style.color = '#1976d2';
            container.style.textAlign = 'center';
            footer.appendChild(container);
          }
        } else {
          container = document.getElementById('winter-plan');
          if(!container){
            container = document.createElement('div');
            container.id = 'winter-plan';
            container.style.position = 'fixed';
            container.style.left = '0';
            container.style.right = '0';
            container.style.bottom = '8px';
            container.style.textAlign = 'center';
            container.style.fontSize = '13px';
            container.style.zIndex = '9999';
            document.body.appendChild(container);
          }
        }
        container.innerHTML = linkHtml;
      }catch(e){}
    })();
  </script>
</body>
</html>