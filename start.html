<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å¼€å§‹ â€” OI æ•™ç»ƒæ¨¡æ‹Ÿå™¨</title>
  <link rel="stylesheet" href="styles.css">
<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "tpe6xsi392");
</script>
</head>
<body>
<div class="container">
  <header>
    <h1>OI æ•™ç»ƒæ¨¡æ‹Ÿå™¨ â€” å¼€å§‹</h1>
  </header>
  <div class="panel">
    <h3>æ–°æ¸¸æˆè®¾ç½®</h3>
    
    <label class="block">é€‰æ‹©éš¾åº¦</label>
    <select id="start-diff">
      <option value="1">ç®€å• - åˆå§‹ç»è´¹æ›´å¤šï¼Œå­¦ç”Ÿèƒ½åŠ›æ›´é«˜</option>
      <option value="2" selected>æ™®é€š - æ ‡å‡†æ¸¸æˆä½“éªŒ</option>
      <option value="3">å›°éš¾ - åˆå§‹ç»è´¹æ›´å°‘ï¼Œå­¦ç”Ÿèƒ½åŠ›æ›´ä½</option>
    </select>

    <label class="block" style="margin-top:10px">é€‰æ‹©çœä»½</label>
    <div class="small muted" style="margin-bottom:6px">ä¸åŒçœä»½å½±å“åˆå§‹ç»è´¹å’Œè®­ç»ƒè´¨é‡ã€‚<strong>å¼ºçœ</strong>èµ„æºä¸°å¯Œä½†æœŸæœ›æ›´é«˜ï¼Œ<strong>å¼±çœ</strong>èµ·æ­¥è¾ƒéš¾ä½†æ›´æœ‰æˆå°±æ„Ÿã€‚</div>
    <div id="start-prov-grid" class="prov-grid"></div>

    <label class="block" style="margin-top:10px">å­¦ç”Ÿäººæ•° (3-10)</label>
    <div class="small muted" style="margin-bottom:6px">æ›´å¤šå­¦ç”Ÿæ„å‘³ç€æ›´å¤šæœºé‡ï¼Œä¹Ÿä¼šå¸¦æ¥æ›´å¤šçš„ç»è´¹å¼€æ”¯</div>
    <input id="start-stu" type="number" min="3" max="10" value="5" />

    <!-- åŸæ‹›ç”Ÿ/å­¦å‰åŸ¹å…» UI å·²ç§»é™¤ã€‚ä¸‹é¢ä»…å±•ç¤ºå¯ç”¨å¤©èµ‹åˆ—è¡¨ -->
    <div class="sub-panel collapsible collapsed" id="talent-only-panel" style="margin-top:12px">
      <h4>æ¸¸æˆæ ¸å¿ƒæ¦‚å¿µ</h4>
      <div class="small muted" style="line-height:1.6;margin-bottom:10px">
        <p><strong>ç›®æ ‡</strong>ï¼šå¸¦é¢†å­¦ç”Ÿåœ¨ä¸¤ä¸ªèµ›å­£å†…å†²å‡»NOIé‡‘ç‰Œ</p>
        <p><strong>å­¦ç”Ÿå±æ€§</strong>ï¼šæ€ç»´ã€ç¼–ç¨‹ã€å¿ƒç†ä¸‰é¡¹åŸºç¡€èƒ½åŠ› + äº”å¤§çŸ¥è¯†ç‚¹ï¼ˆæ•°æ®ç»“æ„ã€å›¾è®ºã€å­—ç¬¦ä¸²ã€æ•°å­¦ã€DPï¼‰</p>
        <p><strong>ç»è´¹ç®¡ç†</strong>ï¼šå‡çº§è®¾æ–½ã€å‚åŠ é›†è®­éƒ½éœ€è¦ç»è´¹ï¼Œéœ€åˆç†è§„åˆ’</p>
        <p><strong>å‹åŠ›ç³»ç»Ÿ</strong>ï¼šé«˜å‹è®­ç»ƒä¼šå¢åŠ å‹åŠ›ï¼Œå‹åŠ›è¿‡é«˜å¯èƒ½å¯¼è‡´é€€é˜Ÿ</p>
        <p><strong>æ¯”èµ›é“¾</strong>ï¼šCSP-S1 â†’ CSP-S2 â†’ NOIP â†’ çœé€‰ â†’ NOIï¼Œå¿…é¡»é€šè¿‡å‰ä¸€åœºæ‰èƒ½å‚åŠ ä¸‹ä¸€åœº</p>
      </div>
  <h4 class="collapsible-head" style="margin-top:16px">å¤©èµ‹é¢„è§ˆ</h4>
  <div class="small muted" style="margin-bottom:6px">å­¦ç”Ÿåœ¨è®­ç»ƒä¸­æœ‰æ¦‚ç‡è·å¾—å¤©èµ‹ï¼Œå¤©èµ‹ä¼šå½±å“æ¯”èµ›è¡¨ç°å’Œè®­ç»ƒæ•ˆæœ</div>
      <div id="talent-grid" class="talent-grid"></div>
      <!-- ä¿ç•™éšè— select ä»¥ä¾¿ä¸æ—§é€»è¾‘å…¼å®¹ï¼ˆä»…ç”¨äºå­˜å‚¨/è¡¨å•åŒæ­¥ï¼‰ -->
      <select id="train-talent" style="display:none"></select>
    </div>

    <div class="modal-actions" style="margin-top:12px">
      <button class="btn btn-ghost" id="start-help">æŸ¥çœ‹è¯¦ç»†å¸®åŠ©</button>
      <button class="btn" id="daily-challenge-btn" style="background:#667eea;color:white;">ğŸ“… ä»Šæ—¥æŒ‘æˆ˜</button>
      <button class="btn" id="start-button">å¼€å§‹æ¸¸æˆ ğŸš€</button>
    </div>
  </div>
</div>

<script src="events.js"></script>
<script src="lib/constants.js"></script>
<script src="lib/utils.js"></script>
<script src="lib/models.js"></script>
<script src="lib/talent.js"></script>
<script src="script.js"></script>
<script>

  // ç§»é™¤å¯¹æ‹›ç”Ÿ/å­¦å‰åŸ¹å…»çŠ¶æ€çš„ç»´æŠ¤ï¼›ä»…æä¾›æ¸²æŸ“å¤©èµ‹ç½‘æ ¼çš„åŠŸèƒ½
  function renderTalentGrid(){
    const grid = document.getElementById('talent-grid');
    const hiddenSelect = document.getElementById('train-talent');
    if(!grid || !hiddenSelect) return;
    grid.innerHTML = '';
    hiddenSelect.innerHTML = '';
    if(typeof window === 'undefined' || !window.TalentManager) return;
    const talents = window.TalentManager.getRegistered();
    talents.forEach(name => {
      const info = window.TalentManager.getTalentInfo(name) || {};
      // populate hidden select
      const opt = document.createElement('option'); opt.value = name; opt.textContent = name; hiddenSelect.appendChild(opt);

      // create card
      const card = document.createElement('div'); card.className = 'talent-card'; card.dataset.val = name;
      const top = document.createElement('div');
      const dot = document.createElement('span'); dot.className = 'color-dot'; dot.style.background = (info.color || '#2b6cb0');
      const title = document.createElement('span'); title.className = 'title'; title.textContent = name;
      top.appendChild(dot); top.appendChild(title);
      const desc = document.createElement('div'); desc.className = 'desc'; desc.textContent = info.description || '';
      card.appendChild(top); card.appendChild(desc);

      card.addEventListener('click', ()=>{
        // å•é€‰é«˜äº®ï¼Œä»…ç”¨äºå±•ç¤º/é€‰æ‹©
        grid.querySelectorAll('.talent-card.selected').forEach(c=>c.classList.remove('selected'));
        card.classList.add('selected');
        hiddenSelect.value = name;
      });

      grid.appendChild(card);
    });
  }

  // é¡µé¢åŠ è½½åæ¸²æŸ“å¤©èµ‹åˆ—è¡¨ï¼šä¼˜å…ˆåœ¨ TalentManager å·²æ³¨å†Œå¤©èµ‹æ—¶ç«‹å³æ¸²æŸ“ï¼Œ
  // å¦åˆ™åœ¨ window.load åå†æ¸²æŸ“ï¼Œå¹¶æä¾›çŸ­è½®è¯¢ä½œä¸ºå›é€€ï¼Œç¡®ä¿åœ¨ registerDefaultTalents ä¹‹åæ¸²æŸ“ã€‚
  function ensureRenderTalentGrid(){
    try{
      if(typeof window !== 'undefined' && window.TalentManager && typeof window.TalentManager.getRegistered === 'function'){
        const reg = window.TalentManager.getRegistered() || [];
        if(reg.length > 0){ renderTalentGrid(); return true; }
      }
    }catch(e){}
    return false;
  }

  if(!ensureRenderTalentGrid()){
    // åœ¨ load äº‹ä»¶åå†å°è¯•ï¼ˆscript.js åœ¨ window.onload ä¸­ä¼šè°ƒç”¨ registerDefaultTalentsï¼‰
    window.addEventListener('load', ()=>{ setTimeout(()=>{ renderTalentGrid(); }, 50); });

    // ä½œä¸ºé¢å¤–ä¿é™©ï¼ŒçŸ­è½®è¯¢ç›´åˆ° TalentManager å‡ºç°æˆ–è¶…æ—¶
    let _tg_tries = 0;
    const _tg_interval = setInterval(()=>{
      _tg_tries += 1;
      if(ensureRenderTalentGrid() || _tg_tries > 12) clearInterval(_tg_interval);
    }, 200);
  }

  // render province buttons using PROVINCES from script.js (ä¿ç•™é¡µé¢å…¶ä»–åŠŸèƒ½çš„å…¼å®¹æ€§)
  if(typeof renderStartPageUI !== 'undefined'){
    renderStartPageUI && renderStartPageUI();
    setTimeout(() => {
      // ä¿ç•™å¸®åŠ©ä¸å¼€å§‹æŒ‰é’®è¡Œä¸º
      document.getElementById('start-help').onclick = ()=>{ window.open('help.html','_blank'); };
      document.getElementById('start-button').onclick = ()=>{ startFromStartPage && startFromStartPage(); };
      
      // ä»Šæ—¥æŒ‘æˆ˜æŒ‰é’®
      document.getElementById('daily-challenge-btn').onclick = ()=>{ 
        if(typeof getDailyChallengeParams === 'function'){
          const params = getDailyChallengeParams();
          // æ˜¾ç¤ºä»Šæ—¥æŒ‘æˆ˜ä¿¡æ¯
          const provinceName = (typeof PROVINCES !== 'undefined' && PROVINCES[params.provinceId]) 
            ? PROVINCES[params.provinceId].name 
            : 'æœªçŸ¥çœä»½';
          
          if(confirm(`ğŸ“… ä»Šæ—¥æŒ‘æˆ˜ï¼ˆ${params.displayDate}ï¼‰\n\nçœä»½ï¼š${provinceName}\néš¾åº¦ï¼šæ™®é€š\nç§å­ï¼š${params.seed}\n\næ‰€æœ‰ç©å®¶ä»Šå¤©éƒ½å°†ä½¿ç”¨ç›¸åŒçš„åˆå§‹æ¡ä»¶ï¼\n\nç¡®è®¤å¼€å§‹ä»Šæ—¥æŒ‘æˆ˜ï¼Ÿ`)){
            // è®¾ç½®ä»Šæ—¥æŒ‘æˆ˜æ ‡è®°
            try {
              sessionStorage.setItem('oi_game_active_session', 'true');
              sessionStorage.setItem('oi_daily_challenge', 'true');
              sessionStorage.setItem('oi_daily_challenge_date', params.date);
            } catch(e) {
              console.error('æ— æ³•è®¾ç½® sessionStorage:', e);
            }
            
            // è·³è½¬åˆ°æ¸¸æˆé¡µé¢ï¼Œå¸¦ä¸Šä»Šæ—¥æŒ‘æˆ˜å‚æ•°
            const url = `game.html?new=1&daily=1&d=${params.difficulty}&p=${params.provinceId}&c=5&seed=${params.seed}`;
            window.location.href = url;
          }
        } else {
          alert('ä»Šæ—¥æŒ‘æˆ˜åŠŸèƒ½åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        }
      };
    }, 100);
  }

    // åˆå§‹åŒ–å¯æŠ˜å é¢æ¿ï¼šé»˜è®¤æŠ˜å å¯¹ç‚¹æ‹›ç”Ÿä¸å­¦å‰åŸ¹å…»ï¼Œç‚¹å‡»æ ‡é¢˜åˆ‡æ¢
  (function(){
    function togglePanel(panel, expand){
      if(expand){
        panel.classList.remove('collapsed');
        panel.classList.add('expanded');
      } else {
        panel.classList.remove('expanded');
        panel.classList.add('collapsed');
      }
    }

    document.querySelectorAll('.sub-panel.collapsible').forEach(panel => {
      const head = panel.querySelector('.collapsible-head');
      // ensure initial state: keep collapsed if class present
      if(panel.classList.contains('collapsed')){
        togglePanel(panel, false);
      } else {
        togglePanel(panel, true);
      }

      head && head.addEventListener('click', ()=>{
        const isCollapsed = panel.classList.contains('collapsed');
        togglePanel(panel, isCollapsed);

        // å¦‚æœå±•å¼€ï¼Œå°è¯•æ¸²æŸ“é¢æ¿å†…çš„å»¶è¿Ÿå†…å®¹ï¼ˆä¾‹å¦‚å¤©èµ‹ç½‘æ ¼ï¼‰
        try{
          if(!isCollapsed){
            // å¦‚æœé¢æ¿åŒ…å«å¤©èµ‹ç½‘æ ¼ï¼Œåˆ™æ¸²æŸ“
            if(panel.querySelector && panel.querySelector('#talent-grid')){
              if(typeof renderTalentGrid === 'function') renderTalentGrid();
            }
            // å…¼å®¹æ—§çš„ train-panel è¡Œä¸º
            if(panel.id === 'train-panel'){
              if(typeof populateTalentSelect === 'function') try{ populateTalentSelect(); }catch(e){}
            }
          }
        }catch(e){}
      });
    });
  })();
</script>
  <footer style="text-align:center;padding:12px 8px;color:#666;font-size:13px;border-top:1px solid #eee;margin-top:18px">
    ä½œè€… @Dreamers-seve Â· æ´›è°·: <a href="https://www.luogu.com.cn/user/668972" target="_blank" rel="noopener">https://www.luogu.com.cn/user/668972</a> Â· GitHub: <a href="https://github.com/seve42/OItrainer" target="_blank" rel="noopener">https://github.com/seve42/OItrainer</a>
  </footer>
</body>
</html>
